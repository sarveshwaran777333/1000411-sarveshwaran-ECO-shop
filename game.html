<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Eco Robo Runner</title>

<style>
body {
  margin: 0;
  background: #e8f5e9;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
  font-family: Arial;
}

.game-container {
  background: white;
  border: 3px solid #2e7d32;
  border-radius: 15px;
  padding: 15px;
  text-align: center;
}

canvas {
  background: #f1f8e9;
  border-radius: 10px;
  display: none;
}

.menu {
  width: 820px;
  height: 320px;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
}

.controls {
  margin-top: 10px;
}

button {
  padding: 8px 18px;
  font-size: 16px;
  margin: 5px;
  border-radius: 6px;
  border: 2px solid #2e7d32;
  background: #c8e6c9;
  cursor: pointer;
}
</style>
</head>

<body>

<div class="game-container">

  <!-- MENU -->
  <div id="menu" class="menu">
    <h1>ðŸ¤– Eco Robo Runner</h1>
    <p>SPACE = Jump | P = Pause</p>
    <button onclick="startGame()">Start Game</button>
  </div>

  <!-- GAME -->
  <canvas id="game" width="820" height="320"></canvas>

  <!-- CONTROLS -->
  <div class="controls">
    <button id="pauseBtn" onclick="togglePause()" style="display:none;">Pause</button>
    <button id="restartBtn" onclick="restartGame()" style="display:none;">Restart</button>
  </div>

</div>

<script>
/* CANVAS */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const menu = document.getElementById("menu");
const pauseBtn = document.getElementById("pauseBtn");
const restartBtn = document.getElementById("restartBtn");

/* ROBO SPRITE */
const robo = new Image();
let spriteLoaded = false;

const FRAME_COUNT = 6;
let frameIndex = 0;
let frameTimer = 0;
const FRAME_SPEED = 6;

let frameWidth = 0;
let frameHeight = 0;

robo.onload = () => {
  spriteLoaded = true;
  frameWidth = robo.width / FRAME_COUNT;
  frameHeight = robo.height;
};

robo.onerror = () => {
  console.error("ROBO_RUN.png not found");
};

robo.src = "./ROBO_RUN.png";

/* GAME STATE */
let gameRunning = false;
let gameOver = false;
let paused = false;

/* PHYSICS */
const groundY = 200;
let y = groundY;
let vy = 0;
const gravity = 0.6;
const jumpPower = -11;
let jumpCount = 0;
const maxJumps = 2;
const SPEED = 4;

/* OBJECTS */
let coins = [];
let obstacles = [];
let score = 0;

/* CONTROLS */
document.addEventListener("keydown", e => {
  if (e.code === "Space" && gameRunning && !paused && !gameOver && jumpCount < maxJumps) {
    vy = jumpPower;
    jumpCount++;
    e.preventDefault();
  }
  if (e.code === "KeyP" && gameRunning && !gameOver) togglePause();
});

/* START */
function startGame() {
  menu.style.display = "none";
  canvas.style.display = "block";
  pauseBtn.style.display = "inline-block";
  restartBtn.style.display = "none";
  resetGame();
  gameRunning = true;
}

/* PAUSE */
function togglePause() {
  paused = !paused;
  pauseBtn.textContent = paused ? "Resume" : "Pause";
}

/* RESTART */
function restartGame() {
  resetGame();
  paused = false;
  gameOver = false;
  gameRunning = true;
  restartBtn.style.display = "none";
  pauseBtn.textContent = "Pause";
}

/* RESET */
function resetGame() {
  coins = [];
  obstacles = [];
  score = 0;
  y = groundY;
  vy = 0;
  jumpCount = 0;
  frameIndex = 0;
  frameTimer = 0;
}

/* COINS (GROUND + FEW ABOVE BLOCKS) */
function spawnCoins() {
  if (Math.random() < 0.02) {
    const groundCoin = Math.random() < 0.7;
    const coinY = groundCoin ? groundY + 20 : groundY - 40;
    const count = groundCoin ? 3 : 2;

    for (let i = 0; i < count; i++) {
      coins.push({ x: canvas.width + i * 34, y: coinY, r: 9 });
    }
  }
}

/* OBSTACLES */
function spawnObstacles() {
  if (Math.random() < 0.02) {
    const isBlock = Math.random() < 0.6;
    obstacles.push({
      x: canvas.width,
      y: groundY + 30,
      w: 30,
      h: 30,
      type: isBlock ? "block" : "spike"
    });
  }
}

/* UPDATE */
function update() {
  if (!gameRunning || gameOver || paused) return;

  vy += gravity;
  y += vy;

  let onPlatform = false;

  obstacles.forEach(o => {
    if (o.type === "block") {
      const falling = vy >= 0;
      const withinX = 50 + 60 > o.x && 50 < o.x + o.w;
      const touchingTop = y + 60 >= o.y && y + 60 <= o.y + o.h;

      if (withinX && touchingTop && falling) {
        y = o.y - 60;
        vy = 0;
        jumpCount = 0;
        onPlatform = true;
      }
    }
  });

  if (!onPlatform && y >= groundY) {
    y = groundY;
    vy = 0;
    jumpCount = 0;
  }

  spawnCoins();
  spawnObstacles();

  coins.forEach(c => c.x -= SPEED);
  obstacles.forEach(o => o.x -= SPEED);

  coins = coins.filter(c => {
    const hit = Math.abs(80 - c.x) < 24 && Math.abs(y + 30 - c.y) < 24;
    if (hit) score++;
    return c.x > -20 && !hit;
  });

  obstacles.forEach(o => {
    if (o.type === "spike") {
      const hit = 50 < o.x + o.w && 110 > o.x && y + 60 > o.y;
      if (hit) {
        gameOver = true;
        gameRunning = false;
        restartBtn.style.display = "inline-block";
      }
    }
  });

  frameTimer++;
  if (frameTimer >= FRAME_SPEED) {
    frameIndex = (frameIndex + 1) % FRAME_COUNT;
    frameTimer = 0;
  }
}

/* DRAW */
function draw() {
  ctx.clearRect(0, 0, canvas.width, canvas.height);

  /* GROUND */
  ctx.fillStyle = "#81c784";
  ctx.fillRect(0, groundY + 60, canvas.width, 6);

  /* EFFECT BEHIND ROBO */
  ctx.globalAlpha = 0.25;
  ctx.fillStyle = "#66bb6a";
  ctx.beginPath();
  ctx.ellipse(80, y + 55, 28, 12, 0, 0, Math.PI * 2);
  ctx.fill();
  ctx.globalAlpha = 1;

  /* ROBO (ON TOP) */
  if (spriteLoaded && frameWidth > 0) {
    ctx.drawImage(
      robo,
      frameIndex * frameWidth,
      0,
      frameWidth,
      frameHeight,
      50,
      y,
      60,
      60
    );
  } else {
    ctx.fillStyle = "#000";
    ctx.fillRect(50, y, 60, 60);
  }

  /* COINS */
  ctx.fillStyle = "gold";
  coins.forEach(c => {
    ctx.beginPath();
    ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
    ctx.fill();
  });

  /* OBSTACLES */
  obstacles.forEach(o => {
    if (o.type === "block") {
      ctx.fillStyle = "#6d4c41";
      ctx.fillRect(o.x, o.y, o.w, o.h);
    } else {
      ctx.fillStyle = "#d32f2f";
      ctx.beginPath();
      ctx.moveTo(o.x, o.y + o.h);
      ctx.lineTo(o.x + o.w / 2, o.y);
      ctx.lineTo(o.x + o.w, o.y + o.h);
      ctx.fill();
    }
  });

  /* UI */
  ctx.fillStyle = "#1b5e20";
  ctx.font = "bold 20px Arial";
  ctx.fillText("Coins: " + score, 20, 30);

  if (paused) {
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "bold 28px Arial";
    ctx.fillText("PAUSED", 360, 160);
  }

  if (gameOver) {
    ctx.fillStyle = "rgba(0,0,0,0.7)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.fillStyle = "white";
    ctx.font = "bold 28px Arial";
    ctx.fillText("GAME OVER", 320, 150);
  }
}

/* LOOP */
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
